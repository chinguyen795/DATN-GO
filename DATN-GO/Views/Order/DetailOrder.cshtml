@model DATN_GO.ViewModels.OrderViewModel

@{
    ViewData["Title"] = "Chi tiết hóa đơn";
    ViewData["UseContainer"] = false;
}

<div class="px-0">
    <div class="row">
        <!-- Left Sidebar -->
        <div class="col-lg-3 col-xl-2 d-none d-lg-block sidebar bg-white border-end">
            <div class="position-sticky" style="top: 1rem;">
                <div class="p-3 border-bottom">
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://i.pinimg.com/736x/f0/cd/c4/f0cdc47ddb7f9dd5e86c3e7915c8b337.jpg" alt="Profile"
                             class="rounded-circle me-2" style="width: 45px; height: 45px;">
                        <div>
                            <h6 class="mb-0">@ViewBag.UserFullName</h6>
                            <small class="text-muted">@ViewBag.UserNickName</small>

                        </div>
                    </div>
                </div>

                <ul class="nav flex-column p-3">
                    <li class="nav-item mb-2">
                        <a href="Profile.html" class="nav-link text-dark">
                            <i class="bi bi-person-circle me-2"></i>
                            Thông tin cá nhân
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="#" class="nav-link active text-danger">
                            <i class="bi bi-box-seam me-2"></i> Đơn hàng của tôi
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="Address.html" class="nav-link text-dark">
                            <i class="bi bi-geo-alt me-2"></i>
                            Địa chỉ
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="Vouchers.html" class="nav-link text-dark">
                            <i class="bi bi-ticket-perforated me-2"></i>
                            Voucher
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="#" class="nav-link text-dark">
                            <i class="bi bi-bell me-2"></i>
                            Thông báo
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link text-dark">
                            <i class="bi bi-box-arrow-right me-2"></i>
                            Đăng xuất
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main content: Order detail -->
        <div class="col-lg-9 col-xl-10 p-4">
            <div class="bg-white p-4 rounded shadow-lg">
                <div class="mb-4">
                    <h4 class="text-danger mb-0">
                        <i class="bi bi-receipt me-2"></i>
                        Chi tiết hóa đơn - Mã đơn hàng: #@Model.Id
                    </h4>
                    <small class="text-muted">Ngày đặt hàng: @Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</small>
                </div>

                <!-- Customer info -->
                <div class="mb-4">
                    <h5>Thông tin khách hàng</h5>
                    <dl class="row">
                        <dt class="col-sm-3">Tên khách hàng:</dt>
                        <dd class="col-sm-9">@Model.CustomerName</dd>

                        <dt class="col-sm-3">Số điện thoại:</dt>
                        <dd class="col-sm-9">@Model.CustomerPhone ?? "Chưa có"</dd>

                        <dt class="col-sm-3">Phương thức giao hàng:</dt>
                        <dd class="col-sm-9">@Model.ShippingMethodName</dd>

                        <dt class="col-sm-3">Phí vận chuyển:</dt>
                        <dd class="col-sm-9">@Model.ShippingFee.ToString("N0") ₫</dd>
                        <dt class="col-sm-3">Voucher áp dụng:</dt>
                        <dd class="col-sm-9">
                            @((Model.VoucherReduce ?? 0).ToString("N0")) ₫
                        </dd>

                        <dt class="col-sm-3">Phương thức thanh toán:</dt>
                        <dd class="col-sm-9">@Model.PaymentMethod</dd>

                        <dt class="col-sm-3">Trạng thái thanh toán:</dt>
                        <dd class="col-sm-9">@Model.PaymentStatus ?? "Chưa cập nhật"</dd>

                        <dt class="col-sm-3">Trạng thái đơn hàng:</dt>
                        <dd class="col-sm-9">
                            <span class="badge @GetBadgeClass(Model.Status)">
                                @Model.Status
                            </span>
                        </dd>
                    </dl>
                </div>

                <!-- Order details: products list -->
                <div class="mb-4">
                    <h5>Chi tiết sản phẩm</h5>
                    <table class="table table-bordered align-middle">
                        <thead class="table-danger">
                            <tr>
                                <th>Hình ảnh</th>
                                <th>Tên sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Đơn giá</th>
                                <th>Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.OrderDetails)
                            {
                                <tr>
                                    <td style="width: 160px;">
                                        <img src="@(item.ProductImage ?? "https://via.placeholder.com/80x80.png?text=No+Image")"
                                             alt="@item.ProductName" class="img-fluid rounded" />
                                    </td>
                                    <td>@item.ProductName</td>
                                    <td>@item.Quantity</td>
                                    <td>@item.UnitPrice.ToString("N0") ₫</td>
                                    <td class="text-danger fw-bold">@((item.UnitPrice * item.Quantity).ToString("N0")) ₫</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <!-- Summary -->
                <div class="text-end fs-5">
                    <p class="mb-1">
                        <strong>Tổng số lượng:</strong> @Model.TotalQuantity sản phẩm
                    </p>
                    <p class="mb-1">
                        <strong>Tổng tiền hàng:</strong> @Model.TotalPrice.ToString("N0") ₫
                    </p>
                    <p class="mb-1">
                        <strong>Phí vận chuyển:</strong> @Model.ShippingFee.ToString("N0") ₫
                    </p>
                    <p class="mb-1">
                        <strong>Giảm giá voucher:</strong> -@((Model.VoucherReduce ?? 0).ToString("N0")) ₫
                    </p>
                    <p class="mb-0 text-danger fw-bold fs-4">
                        Tổng thanh toán: @Model.GrandTotal.ToString("N0") ₫
                    </p>
                </div>

                <div class="mt-4 d-flex justify-content-between">
                    <a href="@Url.Action("Index", "Order")" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left-circle me-1"></i> Quay lại danh sách đơn hàng
                    </a>
                    <button class="btn btn-danger">
                        <i class="bi bi-printer me-1"></i> In hóa đơn
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    // Hàm lấy class badge bootstrap cho từng trạng thái đơn hàng (để hiển thị màu sắc phù hợp)
    private string GetBadgeClass(string status)
    {
        return status.ToLower() switch
        {
            "chờ xác nhận" => "bg-warning",
            "chờ lấy hàng" => "bg-info",
            "đang giao" => "bg-success",
            "đã giao" => "bg-primary",
            "đã hủy" => "bg-danger",
            _ => "bg-secondary",
        };
    }
}