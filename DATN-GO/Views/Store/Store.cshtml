﻿@{
    ViewData["Title"] = "Diner Page";
}

<!-- Filter bar -->
<div class="bg-danger rounded-3 mt-3 mb-5 py-3">
    <div class="d-flex flex-row align-items-center justify-content-between flex-wrap mx-2">
        <div class="text-white fw-bold me-2 my-auto">
            <button class="btn btn-outline-light d-lg-none me-2" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#filterOffcanvas">
                <i class="bi bi-funnel"></i> Bộ lọc
            </button>
            <span>Sắp xếp theo:</span>
        </div>
        <div class="d-flex flex-row gap-2 flex-wrap">
            <button class="btn text-white fw-bold border border-white filter-btn-hover"
                    data-value="rating-desc">
                <i class="bi bi-star-fill me-1"></i>
                <span>Đánh giá cao nhất</span>
            </button>
            <button class="btn text-white fw-bold border border-white filter-btn-hover"
                    data-value="orders-desc">
                <i class="bi bi-bag-check me-1"></i>
                <span>Đơn hàng nhiều nhất</span>
            </button>
            <button class="btn text-white fw-bold border border-white filter-btn-hover" data-value="newest">
                <i class="bi bi-clock-history me-1"></i>
                <span>Mới nhất</span>
            </button>
            <select class="form-select bg-danger text-white fw-bold border-0 border-bottom"
                    style="width: auto; min-width: 150px;" id="statusFilter">
                <option value="">
                    <i class="bi bi-clock"></i> Trạng thái
                </option>
                <option value="open">Đang mở cửa</option>
                <option value="closed">Đã đóng cửa</option>
            </select>
        </div>
    </div>
</div>

<!-- Mobile Filter Offcanvas -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="filterOffcanvas">
    <div class="offcanvas-header text-danger bg-light mx-0">
        <h5 class="offcanvas-title fw-bold">Bộ lọc</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="filter-section">
            <!-- Search -->
            <div class="mb-3">
                <label for="searchInputMobile" class="form-label">
                    <i class="bi bi-search"></i> Tìm kiếm
                </label>
                <input type="text" id="searchInputMobile" class="form-control"
                       placeholder="Tìm theo tên cửa hàng..." />
            </div>
            <!-- Province Filter -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="bi bi-geo-alt"></i> Tỉnh/Thành phố
                </label>
                <select class="form-select" id="provinceFilterMobile">
                    <option value="">Tất cả tỉnh/thành</option>
                    <option value="can-tho">Cần Thơ</option>
                    <option value="hcm">TP. Hồ Chí Minh</option>
                    <option value="ha-noi">Hà Nội</option>
                    <option value="da-nang">Đà Nẵng</option>
                    <option value="an-giang">An Giang</option>
                    <option value="bac-lieu">Bạc Liêu</option>
                    <option value="kien-giang">Kiên Giang</option>
                    <option value="ca-mau">Cà Mau</option>
                    <option value="tien-giang">Tiền Giang</option>
                    <option value="long-an">Long An</option>
                    <option value="dong-thap">Đồng Tháp</option>
                </select>
            </div>

            <!-- Status Filter -->
            <div class="mb-3">
                <label class="form-label">
                    <i class="bi bi-shop"></i> Trạng thái
                </label>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-danger status-filter" type="button" data-status="open">
                        <i class="bi bi-shop"></i> Đang mở cửa
                    </button>
                    <button class="btn btn-outline-danger status-filter" type="button" data-status="closed">
                        <i class="bi bi-shop"></i> Đã đóng cửa
                    </button>
                </div>
            </div>

            <!-- Apply Filters Button -->
            <button class="btn btn-danger w-100" data-bs-dismiss="offcanvas">
                <i class="bi bi-funnel"></i> Áp dụng bộ lọc
            </button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-3 col-md-12">
        <!-- Store Filter -->
        <h5 class="mb-3">Lọc cửa hàng</h5>
        <!-- Search Filter -->
        <div class="mb-3">
            <label for="searchInput" class="form-label">
                <i class="bi bi-search"></i> Tìm kiếm
            </label>
            <input type="text" id="searchInput" class="form-control"
                   placeholder="Tìm theo tên cửa hàng..." />
        </div>

        <!-- Province Filter -->
        <div class="mb-3">
            <label for="provinceSelect" class="form-label">
                <i class="bi bi-geo-alt"></i> Tỉnh/Thành phố
            </label>
            <select class="selectpicker w-100" id="provinceSelect" data-live-search="true"
                    data-width="auto">
                <option value="">Tất cả địa điểm</option>
                <option value="can-tho">Cần Thơ</option>
                <option value="hcm">TP. Hồ Chí Minh</option>
                <option value="ha-noi">Hà Nội</option>
                <option value="da-nang">Đà Nẵng</option>
                <option value="other">Tỉnh/TP khác</option>
            </select>
        </div>
        <!-- Rating Filter -->
        <div class="mb-3">
            <label class="form-label">
                <i class="bi bi-star"></i> Đánh giá
            </label>
            <div class="d-grid gap-2">
                <button class="btn btn-outline-danger rating-filter" type="button" data-rating="4.5"
                        onclick="toggleRatingFilter(this)">
                    Từ 4.5 <i class="bi bi-star-fill"></i>
                </button>
                <button class="btn btn-outline-danger rating-filter" type="button" data-rating="4.0"
                        onclick="toggleRatingFilter(this)">
                    Từ 4.0 <i class="bi bi-star-fill"></i>
                </button>
                <button class="btn btn-outline-danger rating-filter" type="button" data-rating="3.5"
                        onclick="toggleRatingFilter(this)">
                    Từ 3.5 <i class="bi bi-star-fill"></i>
                </button>
            </div>
        </div>

        <!-- Orders Filter -->
        <div class="mb-3">
            <label class="form-label">
                <i class="bi bi-cart-check"></i> Lượt đặt hàng
            </label>
            <div class="d-grid gap-2">
                <button class="btn btn-outline-danger orders-filter" type="button" data-orders="15000"
                        onclick="toggleOrdersFilter(this)">
                    Trên 15k <i class="bi bi-cart-check-fill text-danger ms-1"></i>
                </button>
                <button class="btn btn-outline-danger orders-filter" type="button" data-orders="10000"
                        onclick="toggleOrdersFilter(this)">
                    Trên 10k <i class="bi bi-cart-check-fill text-danger ms-1"></i>
                </button>
                <button class="btn btn-outline-danger orders-filter" type="button" data-orders="5000"
                        onclick="toggleOrdersFilter(this)">
                    Trên 5k <i class="bi bi-cart-check-fill text-danger ms-1"></i>
                </button>
            </div>
        </div>


        <button class="btn btn-danger w-100 mb-4" onclick="applyFilters()">
            <i class="bi bi-search"></i> Tìm kiếm
        </button>

        <!-- End of Store Filter -->
    </div>

    <div class="col-lg-9 col-md-12">
        <div class="row">
            <!-- Card template -->
            <!-- Card 1 -->
            @foreach (var store in Model)
            {

                <div class="col-lg-4 col-md-6 col-sm-6 mb-3">
                    <div class="card h-100">
                        <a href="DetailsDiner.html" class="text-decoration-none text-dark">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-4 align-items-center pt-2">
                                        <img src="@store.Avatar"
                                             alt="" height="70" width="70"
                                             class="rounded-circle object-fit-cover border">
                                    </div>
                                    <div class="col-8">
                                        <h5 class="fw-bold text-truncate">@store.Name</h5>
                                        <div class="d-flex align-items-center mb-1">
                                            <i class="bi bi-geo-alt text-danger me-1"></i>
                                            <p class="text-truncate mb-0 small">@store.Address</p>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <i class="bi bi-shop text-danger me-1"></i>
                                            <span class="badge @(store.Status == StoreStatus.Active ? "bg-success" : "bg-secondary") ms-2">
                                                @(store.Status == StoreStatus.Active ? "Đang hoạt động" : "Đã đóng cửa")
                                            </span>


                                        </div>
                                        <div class="row text-nowrap">
                                            <div class="col-4 d-flex align-items-center">
                                                <span class="fw-bold">4.8</span>
                                                <i class="bi bi-star-fill text-danger ms-1"></i>
                                            </div>
                                            <div class="col-4 d-flex align-items-center">
                                                <span>15k</span>
                                                <i class="bi bi-cart-check-fill text-danger ms-1"></i>
                                            </div>
                                            <div class="col-4 d-flex align-items-center">
                                                <span>30+</span>
                                                <i class="bi bi-box text-danger ms-1"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                        <div class="card-footer bg-white border-top-0 d-flex justify-content-between align-items-center p-3">
                            <a href="Chat.html" class="btn btn-outline-danger btn-sm">
                                <i class="bi bi-chat-dots"></i>
                            </a>
                            <a asp-controller="Store" asp-action="Detail" asp-route-id="@store.Id" class="btn btn-danger flex-grow-1 ms-2">
                                <i class="bi bi-shop me-2"></i>Xem cửa hàng
                            </a>
                        </div>
                    </div>
                </div>
            }

        </div>


    </div>


</div>
<script>
    // Desktop Search
    document.getElementById("searchInput").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            const keyword = this.value;
            window.location.href = `@Url.Action("Diner", "Diner")?search=${encodeURIComponent(keyword)}`;
        }
    });

    // Mobile Search
    document.getElementById("searchInputMobile").addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            const keyword = this.value;
            window.location.href = `@Url.Action("Diner", "Diner")?search=${encodeURIComponent(keyword)}`;
        }
    });

    // Optional: Nút "Tìm kiếm" có thể gọi function applyFilters()
    function applyFilters() {
        const keyword = document.getElementById("searchInput").value;
        window.location.href = `@Url.Action("Diner", "Diner")?search=${encodeURIComponent(keyword)}`;
    }
</script>